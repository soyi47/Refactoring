# Chapter 03. 코드에서 나는 악취

> 🌱 3장에서는 리팩터링할 시점을 찾아본다. 리팩터링이 필요한 혹은 아주 절실한 코드에는 일정한 패턴이 있다. 이 장을 읽고 코드가 풍기는 악취가 무엇인지 찾아보자. 그런 다음 해법으로 제시한 리팩터링 기법을 책의 6~12장에서 찾아 읽고 냄새를 없애는데 도움이 될지 생각해본다. 3장은 켄트 벡과 마틴 파울러가 함께 집필했다. 

<br />

## 3.1 기이한 이름 Mysterious Name

+ 코드는 단순하고 명료하게 작성해야 한다. 코드를 명료하게 표현하는 데 가장 중요한 요소 하나는 바로 '이름'이다. 그래서 함수, 모듈, 변수, 클래스 등은 **그 이름만 보고도 각각이 무슨 일을 하고 어떻게 사용해야 하는지 명확히 알 수 있도록 엄청나게 신경 써서 이름을 지어야 한다.**
+ 이름 바꾸기는 단순히 이름을 다르게 표현하는 연습이 아니다. **마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 숨어 있을 가능성이 높다.** 그래서 **혼란스러운 이름을 잘 정리하다보면 코드가 훨씬 간결해진 때가 많다.**

<br />

## 3.2 중복 코드 Duplicated Code

+ 코드가 중복되면 각각을 볼때마다 차이점이 없는지 주의 깊게 봐야하고, 하나를 변경할 때는 다른 비슷한 코드들도 모두 살펴보고 적절히 수행해야하는 부담이 생긴다. 똑같은 코드 구조가 여러 곳에서 반복된다면 하나로 통합하여 더 나은 프로그램을 만들 수 있다.

+ 먼저 **문장 슬라이스하기**로 비슷한 부분을 한 곳에 모으고, **함수 추출하기**를 써서 추출된 메서드를 호출하도록 바꾼다. 같은 부모로부터 파생된 서브 클래스들에 코드가 중복되어 있다면, **메서드 올리기**를 적용해 부모로 옮긴다.

<br />

## 3.3 긴 함수 Long Function

+ 간접 호출(indirection)의 효과, 즉 코드를 이해하고, 공유하고, 선택하기 쉬워진다는 장점은 함수를 짧게 구성할 때 나오는 것이다. 물론 코드를 읽는 사람 입장에서는 함수가 하는 일을 파악하기 위해 왔다 갔다 하므로 여전히 부담이 된다. 이때 **짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름**이다. 함수 이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다. 이를 위해서는 훨씬 적극적으로 함수를 쪼개야 한다. 주석을 달아야 할 만한 부분은 무조건 함수로 만들고, 함수 이름은 동작 방식이 아닌 '의도(intention)'가 드러나게 짓는다. 심지어 **원래 코드보다 길어지더라도 함수로 뽑는다. 단, 함수 이름에 코드의 목적을 드러내야 한다. 핵심은 함수의 길이가 아닌,  함수의 목적(의도)과 구현 코드의 괴리가 얼마나 큰가다.** 즉, '무엇을 하는지'를 코드가 잘 설명해주지 못할수록 함수로 만드는 게 유리하다.
+ 함수를 짧게 만드는 작업의 99%는 **함수 추출하기**가 차지한다. **함수 본문에서 따로 묶어 빼내면 좋은 코드 덩어리를 찾아 새로운 함수로 만드는 것**이다.
  + **많은 매개변수와 임시 변수는 추출 작업에 방해**가 된다. **임시 변수를 질의 함수로 바꾸기**로 임시 변수의 수를, **매개변수 객체 만들기**와 **객체 통째로 넘기기**로는 매개변수의 수를 줄일 수 있을 것이다. 이를 적용해도 여전히 임시 변수와 매개변수가 너무 많다면, 더 큰 수술이라 할 수 있는 **함수를 명령으로 바꾸기**를 고려해보자.
  + **추출한 코드 덩어리는 어떻게 찾아낼까?**
    1. **주석**을 참고하는 것 - 주석은 코드만으로는 목적을 이해하기 어려운 부분에 달려있는 경우가 많다. **주석을 주석이 설명하는 코드와 함께 함수로 빼내고, 함수 이름은 주석 내용을 토대로 짓는다.** 코드가 단 한 줄이어도 설명할 필요가 있다면 함수로 추출한다.
    2. **조건문이나 반복문**
       + **조건문 분해**하기. 거대한 switch문을 구성하는 **case문마다 함수 추출하기를 적용**해서 각 case의 본문을 함수 호출문 하나로 바꾼다. 같은 조건을 기준으로 나뉘는 switch문이 여러 개라면 **조건문을 다형성으로 바꾸기**를 적용한다.
       + 반복문은 **반복문 째로 내부 코드와 함께 추출하여 독립된 함수로** 만든다. 함수의 적합한 이름이 떠오르지 않는다면 성격이 다른 두 가지 작업이 섞여 있기 때문일 수 있다. 이때는 과감히 **반복문 쪼개기**를 적용하여 작업을 분리한다.

<br />

